<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:coreControls="clr-namespace:Core.Controls.Controls;assembly=Core.Controls"
             x:Class="DayTodayTransactions.Pages.TransactionHistoryPage">

    <Grid RowDefinitions="Auto, *, Auto, Auto" Margin="10">
        <!-- Top Bar -->
        <HorizontalStackLayout Grid.Row="0" HorizontalOptions="End" >
            <Picker Title="Account" 
                 HorizontalOptions="Start"
                 ItemsSource="{Binding ListOfAccounts}" 
                 SelectedItem="{Binding SelectedAccount}">
                <Picker.ItemDisplayBinding>
                    <Binding Path="Name" />
                </Picker.ItemDisplayBinding>
            </Picker>
            <Label Text="Balance :" Margin="10"
                   FontSize="15" 
                   FontAttributes="Bold" 
                   HorizontalOptions="End"
                   VerticalOptions="Center" />
            <Label Text="{Binding Balance}" Margin="10"
                   FontSize="15" 
                   FontAttributes="Bold" 
                   HorizontalOptions="End"
                   VerticalOptions="Center" />
        </HorizontalStackLayout>

        <!-- Scrollable Content Area -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="0">
                <!-- Transactions Card -->
                <coreControls:CardView Title="Transactions">
                    <VerticalStackLayout>
                        <!-- Income Section -->
                        <coreControls:CardView Title="Income Chart">
                            <VerticalStackLayout>
                                <CollectionView x:Name="collectionViewIncome" ItemsSource="{Binding IncomeChartEntries}"
                                                IsVisible="{Binding DoVisibleChart, Converter={StaticResource InverseBooleanConverter}}"
                                                SelectionMode="Single"
                                                SelectionChanged="OnIncomeItemSelected">
                                    <CollectionView.ItemsLayout>
                                        <GridItemsLayout Orientation="Vertical" Span="2" />
                                    </CollectionView.ItemsLayout>
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="10" Margin="5" BackgroundColor="Transparent">
                                                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                                                    <Label Text="{Binding Label}" FontAttributes="Bold" />
                                                    <Label Text="{Binding ValueLabel}" FontSize="Small" />
                                                </VerticalStackLayout>
                                            </Border>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                                <VerticalStackLayout Padding="20" IsVisible="{Binding DoVisibleChart}">
                                    <!--<Label Text="Income Chart" FontSize="24" HorizontalOptions="Center" />-->
                                    <coreControls:BindableChartView Entries="{Binding IncomeChartEntries}" 
                                                                    HeightRequest="200" 
                                                                    HorizontalOptions="Fill" />
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </coreControls:CardView>

                        <!-- Expenses Section -->
                        <coreControls:CardView Title="Expenses Chart">
                            <VerticalStackLayout>
                                <CollectionView x:Name="collectionViewExpense" ItemsSource="{Binding ExpenseChartEntries}"
                                                IsVisible="{Binding DoVisibleChart, Converter={StaticResource InverseBooleanConverter}}"
                                                SelectionMode="Single"
                                                SelectionChanged="OnExpenseItemSelected">
                                    <CollectionView.ItemsLayout>
                                        <GridItemsLayout Orientation="Vertical" Span="2" />
                                    </CollectionView.ItemsLayout>
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="10" Margin="5" BackgroundColor="Transparent">
                                                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                                                    <Label Text="{Binding Label}" FontAttributes="Bold" />
                                                    <Label Text="{Binding ValueLabel}" FontSize="Small" />
                                                </VerticalStackLayout>
                                            </Border>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                                <VerticalStackLayout Padding="20" IsVisible="{Binding DoVisibleChart}">
                                    <!--<Label Text="Expense Chart" FontSize="24" HorizontalOptions="Center" />-->
                                    <coreControls:BindableChartView Entries="{Binding ExpenseChartEntries}" 
                                                                    HeightRequest="200" 
                                                                    HorizontalOptions="Fill" />
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </coreControls:CardView>
                    </VerticalStackLayout>
                </coreControls:CardView>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" ColumnSpacing="10" Padding="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" Text="☰" FontSize="30" Margin="15,15,0,0" Command="{Binding ShowMenuCommand}" />
            <Button Grid.Column="1" Text="Transactions" Margin="15,15,15,0" Command="{Binding ShowContentCommand}" />
            <Button Grid.Column="2" Text="☰" FontSize="30" Margin="0,15,15,0" Command="{Binding ShowMenuCommand}" />
        </Grid>

        <!-- Bottom Buttons -->
        <Grid Grid.Row="3" Grid.ColumnSpan="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Button Text="+" Grid.Column="0" WidthRequest="100" HeightRequest="100" CornerRadius="50"
                    BorderColor="Green" BorderWidth="7" BackgroundColor="Transparent" TextColor="Green"
                    Command="{Binding onAddMoneyClickedCommand}" FontSize="36" />
            <Button Text="-" Grid.Column="2" WidthRequest="100" HeightRequest="100" CornerRadius="50"
                    BorderColor="Red" BorderWidth="7" BackgroundColor="Transparent" TextColor="Red"
                    Command="{Binding onWidthDrawMoneyClickedCommand}" FontSize="36" />
        </Grid>
    </Grid>
</ContentPage>
